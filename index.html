<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniDeck: Rapid PPT Builder</title>
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f4f7f6;
            --slide-ratio: 1.77; /* 16:9 Aspect Ratio */
        }

        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; background: var(--bg); }

        /* HEADER */
        header { background: var(--primary); color: white; padding: 0.8rem 1.5rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h3 { margin: 0; font-weight: 400; letter-spacing: 0.5px; }
        .controls { display: flex; gap: 10px; }
        
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: background 0.2s; color: white; display: flex; align-items: center; gap: 5px; }
        .btn-add { background: #34495e; }
        .btn-add:hover { background: #415b76; }
        .btn-import { background: #27ae60; }
        .btn-import:hover { background: #2ecc71; }
        .btn-export { background: #e67e22; }
        .btn-export:hover { background: #d35400; }
        
        /* Hidden file input */
        #fileInput { display: none; }

        /* LAYOUT CONTAINER */
        .workspace { display: flex; flex: 1; overflow: hidden; }
        
        /* SIDEBAR (Slide List) */
        .sidebar { width: 240px; background: #e8e8e8; border-right: 1px solid #ccc; padding: 10px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .thumbnail { background: white; height: 90px; padding: 10px; cursor: pointer; border: 2px solid transparent; display: flex; flex-direction: column; justify-content: center; position: relative; border-radius: 4px; transition: transform 0.1s; }
        .thumbnail:hover { transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .thumbnail.active { border-color: var(--accent); box-shadow: 0 0 0 1px var(--accent); }
        .thumb-num { position: absolute; top: 5px; left: 8px; font-size: 0.75rem; font-weight: bold; color: #ccc; }
        .thumb-title { font-size: 0.85rem; font-weight: bold; color: #444; margin-left: 15px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        /* EDITOR PANE */
        .editor { flex: 1; padding: 30px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; gap: 20px; max-width: 400px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary); font-size: 0.9rem; }
        input[type="text"], textarea, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; font-size: 0.95rem; background: #fdfdfd; }
        input[type="text"]:focus, textarea:focus, select:focus { outline: none; border-color: var(--accent); background: white; }
        textarea { height: 200px; resize: vertical; line-height: 1.5; }
        .hint { font-size: 0.8rem; color: #888; margin-top: 5px; }

        /* PREVIEW PANE */
        .preview-area { flex: 1.5; background: #dcdcdc; display: flex; align-items: center; justify-content: center; padding: 40px; }
        .slide-preview {
            width: 100%; max-width: 800px;
            aspect-ratio: var(--slide-ratio);
            background: white;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            padding: 50px;
            display: flex; flex-direction: column;
            border-radius: 4px;
        }

        /* DYNAMIC THEMES (CSS for Preview) */
        /* Theme: Academic */
        .theme-academic { background: white; color: #333; }
        .theme-academic h2 { border-bottom: 4px solid #2c3e50; color: #2c3e50; margin-bottom: 30px; font-size: 2.5rem; }
        .theme-academic li { margin-bottom: 15px; font-size: 1.3rem; }

        /* Theme: Dark */
        .theme-dark { background: #222; color: #eee; }
        .theme-dark h2 { color: #3498db; margin-bottom: 30px; font-size: 2.5rem; }
        .theme-dark li { margin-bottom: 15px; font-size: 1.3rem; color: #ccc; }

        /* Theme: Blueprint */
        .theme-engineering { background: #003366; color: white; background-image: radial-gradient(#ffffff 1px, transparent 1px); background-size: 20px 20px; }
        .theme-engineering h2 { color: #ffcc00; text-transform: uppercase; letter-spacing: 2px; border-bottom: 2px dashed #ffcc00; padding-bottom: 10px; }
        .theme-engineering li { font-family: 'Courier New', monospace; font-size: 1.2rem; margin-bottom: 15px; }

    </style>
</head>
<body>

<header>
    <h3>UniDeck</h3>
    <div class="controls">
        <input type="file" id="fileInput" accept=".txt" onchange="handleFileImport(this)">
        <button class="btn btn-import" onclick="document.getElementById('fileInput').click()">ðŸ“‚ Import .TXT</button>
        <button class="btn btn-add" onclick="addSlide()">+ New Slide</button>
        <button class="btn btn-export" onclick="exportPPT()">â¬‡ PPTX</button>
    </div>
</header>

<div class="workspace">
    <div class="sidebar" id="thumbnailList"></div>

    <div class="editor">
        <div class="form-group">
            <label>Design Theme</label>
            <select id="themeSelect" onchange="updatePreview()">
                <option value="academic">Academic (Clean)</option>
                <option value="dark">Night Mode (Contrast)</option>
                <option value="engineering">Blueprint (Tech)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Slide Title</label>
            <input type="text" id="inpTitle" oninput="updateCurrentSlide()" placeholder="E.g., Lecture Objectives">
        </div>
        
        <div class="form-group">
            <label>Key Points</label>
            <textarea id="inpBody" oninput="updateCurrentSlide()" placeholder="- Point one&#10;- Point two"></textarea>
            <div class="hint">Tip: Use short bullet points for better retention.</div>
        </div>
        
        <div style="margin-top:auto">
            <button class="btn btn-add" style="width:100%; background:#c0392b; justify-content:center;" onclick="deleteSlide()">Delete Slide</button>
        </div>
    </div>

    <div class="preview-area">
        <div id="slidePreview" class="slide-preview theme-academic">
            <h2 id="prevTitle">Title</h2>
            <div id="prevBody">Body text...</div>
        </div>
    </div>
</div>

<script>
    // --- STATE ---
    let slides = [
        { title: "Welcome to UniDeck", body: "- Import your lecture notes (.txt)\n- Choose a theme\n- Download as PowerPoint" }
    ];
    let currentIdx = 0;

    // --- INITIALIZATION ---
    function init() {
        renderThumbnails();
        loadSlide(0);
    }

    // --- IMPORT LOGIC ---
    function handleFileImport(input) {
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const text = e.target.result;
            parseTextToSlides(text);
        };
        reader.readAsText(file);
        
        // Reset input so same file can be selected again if needed
        input.value = ''; 
    }

    function parseTextToSlides(text) {
        const lines = text.split('\n');
        let newSlides = [];
        let currentSlide = null;

        lines.forEach(line => {
            const trimmed = line.trim();
            if (!trimmed) return; // Skip empty lines

            if (trimmed.startsWith('#')) {
                // Save previous slide if exists
                if (currentSlide) newSlides.push(currentSlide);
                
                // Start new slide (remove '#' and spaces)
                currentSlide = { 
                    title: trimmed.replace(/^#+\s*/, ''), 
                    body: "" 
                };
            } else {
                // It's a bullet point
                if (currentSlide) {
                    currentSlide.body += (currentSlide.body ? "\n" : "") + trimmed;
                } else {
                    // Handling text at the top of file before first header
                    currentSlide = { title: "Introduction", body: trimmed };
                }
            }
        });
        
        // Push the last slide
        if (currentSlide) newSlides.push(currentSlide);

        if (newSlides.length > 0) {
            slides = newSlides; // Replace existing slides
            currentIdx = 0;
            renderThumbnails();
            loadSlide(0);
            alert(`Successfully imported ${slides.length} slides!`);
        } else {
            alert("Could not parse slides. Ensure titles start with '#'.");
        }
    }

    // --- CORE LOGIC ---
    function addSlide() {
        slides.push({ title: "New Slide", body: "- New point" });
        renderThumbnails();
        loadSlide(slides.length - 1);
    }

    function deleteSlide() {
        if(slides.length <= 1) return alert("You must keep at least one slide.");
        slides.splice(currentIdx, 1);
        currentIdx = Math.max(0, currentIdx - 1);
        renderThumbnails();
        loadSlide(currentIdx);
    }

    function loadSlide(index) {
        currentIdx = index;
        const slide = slides[index];
        document.getElementById('inpTitle').value = slide.title;
        document.getElementById('inpBody').value = slide.body;
        
        document.querySelectorAll('.thumbnail').forEach((t, i) => {
            t.classList.toggle('active', i === index);
        });
        updatePreview();
    }

    function updateCurrentSlide() {
        slides[currentIdx].title = document.getElementById('inpTitle').value;
        slides[currentIdx].body = document.getElementById('inpBody').value;
        
        // Update thumbnail text
        const thumbs = document.getElementById('thumbnailList').children;
        if(thumbs[currentIdx]) {
            thumbs[currentIdx].querySelector('.thumb-title').innerText = slides[currentIdx].title;
        }
        updatePreview();
    }

    function updatePreview() {
        const title = document.getElementById('inpTitle').value;
        const bodyRaw = document.getElementById('inpBody').value;
        const theme = document.getElementById('themeSelect').value;
        
        document.getElementById('prevTitle').innerText = title;
        
        let htmlBody = "<ul>";
        bodyRaw.split('\n').forEach(line => {
            let clean = line.trim().replace(/^-/, '').trim();
            if(clean) htmlBody += `<li>${clean}</li>`;
        });
        htmlBody += "</ul>";
        document.getElementById('prevBody').innerHTML = htmlBody;

        document.getElementById('slidePreview').className = `slide-preview theme-${theme}`;
    }

    function renderThumbnails() {
        const container = document.getElementById('thumbnailList');
        container.innerHTML = '';
        slides.forEach((s, i) => {
            const div = document.createElement('div');
            div.className = `thumbnail ${i === currentIdx ? 'active' : ''}`;
            div.innerHTML = `<span class="thumb-num">${i+1}</span> <span class="thumb-title">${s.title}</span>`;
            div.onclick = () => loadSlide(i);
            container.appendChild(div);
        });
    }

    // --- PPT EXPORT ---
    function exportPPT() {
        let pres = new PptxGenJS();
        const themeVal = document.getElementById('themeSelect').value;
        
        // Define Theme Colors
        let colors = { bg: "FFFFFF", title: "2c3e50", body: "333333" };
        if(themeVal === 'dark') colors = { bg: "222222", title: "3498db", body: "eeeeee" };
        if(themeVal === 'engineering') colors = { bg: "003366", title: "ffcc00", body: "ffffff" };

        slides.forEach(slideData => {
            let slide = pres.addSlide();
            slide.background = { color: colors.bg };

            // Title
            slide.addText(slideData.title, { 
                x: 0.5, y: 0.5, w: "90%", h: 1, 
                fontSize: 32, bold: true, color: colors.title, fontFace: "Arial"
            });

            // Bullets
            let bulletLines = slideData.body.split('\n').map(line => {
                return { text: line.replace(/^-/, '').trim(), options: { breakLine: true } };
            });

            slide.addText(bulletLines, {
                x: 0.5, y: 1.5, w: "90%", h: 4,
                fontSize: 18, color: colors.body, bullet: true, fontFace: "Arial", lineSpacing: 28
            });
            
            // Footer
            slide.addText(`UniDeck | ${new Date().toLocaleDateString()}`, { 
                x: 0.5, y: 5.25, w: "90%", h: 0.3, 
                fontSize: 10, color: "888888" 
            });
        });

        pres.writeFile({ fileName: "UniDeck_Lecture.pptx" });
    }

    init();
</script>

</body>
</html>
