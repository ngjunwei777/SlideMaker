<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniDeck: PPT Generator</title>
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f4f7f6;
            --slide-ratio: 1.77; /* 16:9 */
        }

        body { margin: 0; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER */
        header { background: var(--primary); color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        .controls { display: flex; gap: 10px; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; }
        .btn-add { background: #3498db; }
        .btn-export { background: #e67e22; } /* Orange for action */

        /* LAYOUT */
        .workspace { display: flex; flex: 1; overflow: hidden; }
        
        /* SIDEBAR */
        .sidebar { width: 220px; background: #e0e0e0; border-right: 1px solid #ccc; padding: 10px; overflow-y: auto; }
        .thumbnail { background: white; height: 80px; margin-bottom: 10px; padding: 5px; cursor: pointer; border: 2px solid transparent; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; color: #555; position: relative; }
        .thumbnail.active { border-color: var(--accent); }
        .thumb-num { position: absolute; top: 2px; left: 4px; font-weight: bold; color: #999; }

        /* EDITOR */
        .editor { flex: 1; padding: 20px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; gap: 15px; }
        input, textarea, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-top: 5px; }
        textarea { height: 120px; resize: vertical; }
        
        /* PREVIEW */
        .preview-area { flex: 1.5; background: #ccc; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .slide-preview {
            width: 90%; aspect-ratio: var(--slide-ratio);
            background: white; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            padding: 40px; display: flex; flex-direction: column;
            transition: all 0.3s ease;
        }

        /* DYNAMIC THEMES (CSS for Preview Only) */
        /* 1. Classic Academic */
        .theme-academic { background: white; color: #333; }
        .theme-academic h2 { border-bottom: 2px solid #2c3e50; color: #2c3e50; }
        
        /* 2. Modern Dark */
        .theme-dark { background: #222; color: #eee; }
        .theme-dark h2 { color: #3498db; }

        /* 3. Engineering Blue */
        .theme-engineering { background: #f0f8ff; color: #003366; }
        .theme-engineering h2 { color: #004080; text-transform: uppercase; letter-spacing: 1px; }

    </style>
</head>
<body>

<header>
    <h3>UniDeck PPT Builder</h3>
    <div class="controls">
        <button class="btn btn-add" onclick="addSlide()">+ Add Slide</button>
        <button class="btn btn-export" onclick="exportPPT()">â¬‡ Download .PPTX</button>
    </div>
</header>

<div class="workspace">
    <div class="sidebar" id="thumbnailList"></div>

    <div class="editor">
        <h3>Edit Content</h3>
        <div>
            <label>Educational Theme</label>
            <select id="themeSelect" onchange="updatePreview()">
                <option value="academic">Classic Academic (Clean & Formal)</option>
                <option value="dark">Modern Dark (High Contrast)</option>
                <option value="engineering">Engineering (Blueprint Style)</option>
            </select>
        </div>
        <hr style="width:100%; border:0; border-top:1px solid #eee;">
        <div>
            <label>Slide Title</label>
            <input type="text" id="inpTitle" oninput="updateCurrentSlide()" placeholder="Slide Heading...">
        </div>
        <div>
            <label>Bullet Points</label>
            <textarea id="inpBody" oninput="updateCurrentSlide()" placeholder="- Point 1&#10;- Point 2"></textarea>
        </div>
    </div>

    <div class="preview-area">
        <div id="slidePreview" class="slide-preview theme-academic">
            <h2 id="prevTitle">Title</h2>
            <div id="prevBody">Body text...</div>
        </div>
    </div>
</div>

<script>
    // --- DATA STATE ---
    let slides = [
        { title: "Lecture 1: Introduction", body: "- Overview of course\n- Grading scheme\n- Resources" },
        { title: "Core Concepts", body: "- Definition of Terms\n- Historical Context\n- Modern Applications" }
    ];
    let currentIdx = 0;

    // --- INIT ---
    function init() {
        renderThumbnails();
        loadSlide(0);
    }

    // --- APP LOGIC ---
    function addSlide() {
        slides.push({ title: "New Concept", body: "- Detail A\n- Detail B" });
        renderThumbnails();
        loadSlide(slides.length - 1);
    }

    function loadSlide(index) {
        currentIdx = index;
        const slide = slides[index];
        document.getElementById('inpTitle').value = slide.title;
        document.getElementById('inpBody').value = slide.body;
        
        // Highlight thumbnail
        document.querySelectorAll('.thumbnail').forEach((t, i) => {
            t.classList.toggle('active', i === index);
        });
        updatePreview();
    }

    function updateCurrentSlide() {
        slides[currentIdx].title = document.getElementById('inpTitle').value;
        slides[currentIdx].body = document.getElementById('inpBody').value;
        renderThumbnailsText();
        updatePreview();
    }

    function updatePreview() {
        const title = document.getElementById('inpTitle').value;
        const bodyRaw = document.getElementById('inpBody').value;
        const theme = document.getElementById('themeSelect').value;
        
        // Update Content
        document.getElementById('prevTitle').innerText = title;
        
        // Convert newlines to HTML for preview
        let htmlBody = "<ul>";
        bodyRaw.split('\n').forEach(line => {
            let clean = line.trim().replace(/^-/, '').trim();
            if(clean) htmlBody += `<li>${clean}</li>`;
        });
        htmlBody += "</ul>";
        document.getElementById('prevBody').innerHTML = htmlBody;

        // Update Theme Class
        const previewEl = document.getElementById('slidePreview');
        previewEl.className = `slide-preview theme-${theme}`;
    }

    function renderThumbnails() {
        const container = document.getElementById('thumbnailList');
        container.innerHTML = '';
        slides.forEach((s, i) => {
            const div = document.createElement('div');
            div.className = `thumbnail ${i === currentIdx ? 'active' : ''}`;
            div.innerHTML = `<span class="thumb-num">${i+1}</span> <span>${s.title.substring(0, 15)}...</span>`;
            div.onclick = () => loadSlide(i);
            container.appendChild(div);
        });
    }

    function renderThumbnailsText() {
        const thumbs = document.getElementById('thumbnailList').children;
        if(thumbs[currentIdx]) {
            thumbs[currentIdx].querySelectorAll('span')[1].innerText = slides[currentIdx].title.substring(0, 15) + "...";
        }
    }

    // --- PPTX GENERATION LOGIC ---
    function exportPPT() {
        // 1. Create a new Presentation
        let pres = new PptxGenJS();
        
        // 2. Get Selected Theme Properties
        const themeVal = document.getElementById('themeSelect').value;
        let themeColors = { bg: "FFFFFF", title: "2c3e50", body: "333333" };
        
        if(themeVal === 'dark') {
            themeColors = { bg: "222222", title: "3498db", body: "eeeeee" };
        } else if (themeVal === 'engineering') {
            themeColors = { bg: "f0f8ff", title: "004080", body: "003366" };
        }

        // 3. Loop through slides and add to PPT
        slides.forEach(slideData => {
            let slide = pres.addSlide();
            
            // Apply Background
            slide.background = { color: themeColors.bg };

            // Add Title
            slide.addText(slideData.title, { 
                x: 0.5, y: 0.5, w: "90%", h: 1, 
                fontSize: 32, 
                bold: true, 
                color: themeColors.title,
                fontFace: "Arial"
            });

            // Add Body (Bullet Points)
            // We split lines to make them bullets
            let bulletLines = slideData.body.split('\n').map(line => {
                return { text: line.replace(/^-/, '').trim(), options: { breakLine: true } };
            });

            slide.addText(bulletLines, {
                x: 0.5, y: 1.8, w: "90%", h: 4,
                fontSize: 18,
                color: themeColors.body,
                bullet: true,
                fontFace: "Arial",
                lineSpacing: 32
            });
            
            // Add Footer
            slide.addText("Generated by UniDeck", { 
                x: 0.5, y: 5.2, w: "90%", h: 0.5, 
                fontSize: 10, color: "999999" 
            });
        });

        // 4. Save the file
        pres.writeFile({ fileName: "Lecture_Slides.pptx" });
    }

    // Start
    init();

</script>
</body>
</html>
