<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniDeck Pro: Course Builder</title>
    <!-- PptxGenJS for PowerPoint Generation -->
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <style>
        :root {
            --primary: #0f172a;
            --secondary: #3b82f6;
            --accent: #f59e0b;
            --bg: #f1f5f9;
            --panel-bg: #ffffff;
            --border: #e2e8f0;
        }

        body { margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; height: 100vh; display: flex; flex-direction: column; background: var(--bg); color: #333; }
        
        /* HEADER */
        header { background: var(--primary); color: white; padding: 0 1.5rem; height: 60px; display: flex; justify-content: space-between; align-items: center; }
        .brand { font-size: 1.2rem; font-weight: 700; letter-spacing: 1px; display: flex; align-items: center; gap: 10px; }
        .badge { background: var(--accent); color: black; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; }
        
        .header-controls { display: flex; gap: 10px; }
        .meta-input { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 5px 10px; border-radius: 4px; width: 120px; }
        .meta-input::placeholder { color: rgba(255,255,255,0.5); }

        /* BUTTONS */
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px; }
        .btn-primary { background: var(--secondary); color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-success { background: #10b981; color: white; }
        .btn-outline { background: transparent; border: 1px solid rgba(255,255,255,0.3); color: white; }
        .btn-icon { padding: 6px; background: #eee; color: #555; }
        
        /* WORKSPACE GRID */
        .workspace { display: flex; flex: 1; overflow: hidden; }

        /* LEFT: SLIDE MANAGER */
        .sidebar { width: 220px; background: #f8fafc; border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 10px; border-bottom: 1px solid var(--border); font-size: 0.8rem; font-weight: bold; color: #64748b; text-transform: uppercase; }
        .slide-list { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; }
        
        .thumb { background: white; padding: 10px; border: 2px solid transparent; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; gap: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); position: relative; }
        .thumb:hover { border-color: #cbd5e1; }
        .thumb.active { border-color: var(--secondary); box-shadow: 0 0 0 1px var(--secondary); }
        .thumb-num { font-size: 0.7rem; font-weight: bold; color: #94a3b8; }
        .thumb-title { font-size: 0.8rem; font-weight: 600; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .thumb-type { font-size: 0.65rem; color: #64748b; background: #f1f5f9; padding: 2px 4px; border-radius: 3px; align-self: flex-start; }

        /* CENTER: EDITOR */
        .editor { flex: 1; background: white; display: flex; flex-direction: column; border-right: 1px solid var(--border); overflow-y: auto; }
        .editor-toolbar { padding: 10px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: #f8fafc; }
        .editor-content { padding: 30px; max-width: 600px; margin: 0 auto; width: 100%; display: flex; flex-direction: column; gap: 20px; }

        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9rem; color: #334155; }
        input[type="text"], textarea, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-family: inherit; transition: border 0.2s; box-sizing: border-box; }
        input:focus, textarea:focus { outline: none; border-color: var(--secondary); }
        textarea { resize: vertical; min-height: 100px; line-height: 1.5; }

        .symbol-bar { display: flex; gap: 5px; flex-wrap: wrap; margin-top: 5px; }
        .sym-btn { background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 0.9rem; }
        .sym-btn:hover { background: #e2e8f0; }

        /* IMAGE UPLOAD BOX */
        .img-drop-zone { border: 2px dashed #cbd5e1; border-radius: 8px; padding: 20px; text-align: center; color: #64748b; cursor: pointer; transition: all 0.2s; }
        .img-drop-zone:hover { border-color: var(--secondary); background: #eff6ff; }
        .img-preview { max-width: 100%; max-height: 150px; margin-top: 10px; border-radius: 4px; display: none; border: 1px solid #ddd; }

        /* RIGHT: PREVIEW */
        .preview-pane { flex: 1.2; background: #cbd5e1; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
        .preview-header { margin-bottom: 10px; font-size: 0.8rem; font-weight: bold; color: #475569; }
        
        .slide-frame {
            background: white; width: 100%; aspect-ratio: 16/9; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-radius: 4px; padding: 40px; display: flex; flex-direction: column;
            position: relative; overflow: hidden;
        }

        /* PREVIEW STYLES */
        .slide-footer { position: absolute; bottom: 15px; right: 20px; font-size: 10px; color: #94a3b8; display: flex; gap: 15px; }
        .prev-content h2 { margin-top: 0; color: var(--primary); font-size: 2em; border-bottom: 3px solid var(--accent); padding-bottom: 15px; margin-bottom: 20px; }
        .prev-content li { font-size: 1.1em; margin-bottom: 10px; color: #334155; }
        .prev-content .solution-box { background: #f0fdf4; border-left: 4px solid #16a34a; padding: 15px; margin-top: 20px; font-size: 0.9em; color: #166534; display: block; }
        .prev-content img { max-width: 100%; max-height: 250px; object-fit: contain; margin: 10px 0; border: 1px solid #eee; }

    </style>
</head>
<body>

<header>
    <div class="brand">
        <span>UniDeck</span>
        <span class="badge">PRO</span>
    </div>
    <div class="header-controls">
        <input type="text" id="courseCode" class="meta-input" placeholder="Course Code" value="CS101">
        <input type="text" id="weekNum" class="meta-input" placeholder="Week #" value="Week 1">
        
        <div style="width: 1px; background: rgba(255,255,255,0.3); margin: 0 10px;"></div>

        <button class="btn btn-outline" onclick="exportPPT('student')">üéì Student PDF</button>
        <button class="btn btn-success" onclick="exportPPT('lecturer')">üë®‚Äçüè´ Lecturer PPT</button>
    </div>
</header>

<div class="workspace">
    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="sidebar-header">Slide Deck</div>
        <div class="slide-list" id="slideList">
            <!-- Thumbnails injected here -->
        </div>
        <div style="padding: 10px;">
            <button class="btn btn-primary" style="width:100%; justify-content:center;" onclick="addSlide()">+ New Slide</button>
        </div>
    </div>

    <!-- EDITOR -->
    <div class="editor">
        <div class="editor-toolbar">
            <span style="font-weight:bold; color:#475569;">Editor</span>
            <button class="btn btn-icon" onclick="deleteSlide()" title="Delete Slide">üóëÔ∏è</button>
        </div>

        <div class="editor-content">
            <!-- Slide Type -->
            <div class="form-group">
                <label>Slide Type</label>
                <select id="inputType" onchange="updateCurrentSlide()">
                    <option value="theory">üìñ Lecture Theory</option>
                    <option value="tutorial">‚ùì Tutorial Question</option>
                    <option value="discussion">üí¨ Class Discussion</option>
                </select>
            </div>

            <!-- Title -->
            <div class="form-group">
                <label>Slide Title</label>
                <input type="text" id="inputTitle" oninput="updateCurrentSlide()" placeholder="Topic Header...">
            </div>

            <!-- Image Upload -->
            <div class="form-group">
                <label>Visual Aid (Optional)</label>
                <div class="img-drop-zone" onclick="document.getElementById('fileInput').click()">
                    <span>Click to upload Image</span>
                    <input type="file" id="fileInput" accept="image/*" style="display:none" onchange="handleImageUpload(this)">
                </div>
                <img id="imgPreview" class="img-preview">
                <button id="btnRemoveImg" class="btn btn-icon" style="display:none; margin-top:5px; width:100%;" onclick="removeImage()">Remove Image</button>
            </div>

            <!-- Content -->
            <div class="form-group">
                <label>Main Content / Question</label>
                <div class="symbol-bar">
                    <button class="sym-btn" onclick="insertSym('‚Üí')">‚Üí</button>
                    <button class="sym-btn" onclick="insertSym('‚à¥')">‚à¥</button>
                    <button class="sym-btn" onclick="insertSym('Œ∏')">Œ∏</button>
                    <button class="sym-btn" onclick="insertSym('œÄ')">œÄ</button>
                    <button class="sym-btn" onclick="insertSym('‚àë')">‚àë</button>
                    <button class="sym-btn" onclick="insertSym('Œî')">Œî</button>
                    <button class="sym-btn" onclick="insertSym('¬≤')">¬≤</button>
                </div>
                <textarea id="inputBody" oninput="updateCurrentSlide()" placeholder="- Key point 1..."></textarea>
            </div>

            <!-- Tutorial Solution / Speaker Notes -->
            <div class="form-group">
                <label id="lblExtra">Speaker Notes / Solution</label>
                <textarea id="inputExtra" oninput="updateCurrentSlide()" style="background:#f0fdf4; border-color:#86efac;" placeholder="Hidden from students in tutorial mode..."></textarea>
                <small style="color:#64748b; font-style:italic;">This content appears in Lecturer View but is hidden in Student View.</small>
            </div>
        </div>
    </div>

    <!-- PREVIEW -->
    <div class="preview-pane">
        <div class="preview-header">LIVE PREVIEW (Lecturer View)</div>
        <div class="slide-frame">
            <div class="prev-content" id="previewContent">
                <!-- Live content -->
            </div>
            <div class="slide-footer">
                <span id="prevCourse">CS101</span>
                <span id="prevWeek">Week 1</span>
                <span>UniDeck Pro</span>
            </div>
        </div>
    </div>
</div>

<script>
    // --- STATE MANAGEMENT ---
    let slides = [
        { 
            type: 'theory', 
            title: 'Course Introduction', 
            body: '- Welcome to the semester\n- Reviewing the syllabus',
            extra: 'Note: Take attendance first.',
            imgData: null 
        },
        { 
            type: 'tutorial', 
            title: 'Practice Problem 1', 
            body: 'Calculate the velocity of an object in freefall after 5 seconds.\nAssuming g = 9.8 m/s¬≤.',
            extra: 'Solution:\nv = u + at\nv = 0 + (9.8 * 5)\nv = 49 m/s',
            imgData: null 
        }
    ];
    let currentIdx = 0;

    // --- INIT ---
    function init() {
        renderList();
        loadSlide(0);
        
        // Listeners for meta inputs
        document.getElementById('courseCode').addEventListener('input', updateFooter);
        document.getElementById('weekNum').addEventListener('input', updateFooter);
    }

    // --- CORE LOGIC ---
    function addSlide() {
        slides.push({ 
            type: 'theory', 
            title: 'New Topic', 
            body: '- Point 1', 
            extra: '', 
            imgData: null 
        });
        renderList();
        loadSlide(slides.length - 1);
    }

    function deleteSlide() {
        if(slides.length <= 1) return alert("Deck must have at least one slide.");
        slides.splice(currentIdx, 1);
        currentIdx = Math.max(0, currentIdx - 1);
        renderList();
        loadSlide(currentIdx);
    }

    function loadSlide(index) {
        currentIdx = index;
        const s = slides[index];

        document.getElementById('inputType').value = s.type;
        document.getElementById('inputTitle').value = s.title;
        document.getElementById('inputBody').value = s.body;
        document.getElementById('inputExtra').value = s.extra || "";
        
        // Handle Image UI
        const imgPrev = document.getElementById('imgPreview');
        const btnRem = document.getElementById('btnRemoveImg');
        if(s.imgData) {
            imgPrev.src = s.imgData;
            imgPrev.style.display = 'block';
            btnRem.style.display = 'block';
        } else {
            imgPrev.style.display = 'none';
            btnRem.style.display = 'none';
            imgPrev.src = "";
        }

        // Dynamic Label for "Extra" field
        const lbl = document.getElementById('lblExtra');
        if(s.type === 'tutorial') lbl.innerText = "Solution (Hidden for Students)";
        else lbl.innerText = "Speaker Notes";

        highlightThumb(index);
        updatePreview();
    }

    function updateCurrentSlide() {
        const s = slides[currentIdx];
        s.type = document.getElementById('inputType').value;
        s.title = document.getElementById('inputTitle').value;
        s.body = document.getElementById('inputBody').value;
        s.extra = document.getElementById('inputExtra').value;
        
        // Update list title text
        const thumbs = document.getElementById('slideList').children;
        if(thumbs[currentIdx]) {
            thumbs[currentIdx].querySelector('.thumb-title').innerText = s.title;
            thumbs[currentIdx].querySelector('.thumb-type').innerText = s.type.toUpperCase();
        }

        // Update Label
        const lbl = document.getElementById('lblExtra');
        if(s.type === 'tutorial') lbl.innerText = "Solution (Hidden for Students)";
        else lbl.innerText = "Speaker Notes";

        updatePreview();
    }

    // --- IMAGE HANDLING ---
    function handleImageUpload(input) {
        const file = input.files[0];
        if(!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            slides[currentIdx].imgData = e.target.result;
            loadSlide(currentIdx); // Reload UI
        };
        reader.readAsDataURL(file);
        input.value = '';
    }

    function removeImage() {
        slides[currentIdx].imgData = null;
        loadSlide(currentIdx);
    }

    function insertSym(char) {
        const textarea = document.getElementById('inputBody');
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const text = textarea.value;
        textarea.value = text.substring(0, start) + char + text.substring(end);
        textarea.focus();
        textarea.selectionEnd = start + 1;
        updateCurrentSlide();
    }

    // --- RENDERERS ---
    function renderList() {
        const list = document.getElementById('slideList');
        list.innerHTML = '';
        slides.forEach((s, i) => {
            const div = document.createElement('div');
            div.className = `thumb ${i === currentIdx ? 'active' : ''}`;
            div.onclick = () => loadSlide(i);
            div.innerHTML = `
                <div class="thumb-type">${s.type.toUpperCase()}</div>
                <div class="thumb-title">${s.title}</div>
                <div class="thumb-num">Slide ${i+1}</div>
            `;
            list.appendChild(div);
        });
    }

    function highlightThumb(index) {
        Array.from(document.getElementById('slideList').children).forEach((el, i) => {
            el.classList.toggle('active', i === index);
        });
    }

    function updatePreview() {
        const s = slides[currentIdx];
        const container = document.getElementById('previewContent');
        
        let html = `<h2>${s.title}</h2>`;
        
        // Image
        if(s.imgData) {
            html += `<div style="text-align:center"><img src="${s.imgData}"></div>`;
        }

        // Body bullets
        if(s.body) {
            html += `<ul>${s.body.split('\n').map(l => l.trim() ? `<li>${l.replace(/^-/,'')}</li>` : '').join('')}</ul>`;
        }

        // Extra (Solution/Notes)
        if(s.extra) {
            const label = s.type === 'tutorial' ? "SOLUTION:" : "SPEAKER NOTE:";
            html += `<div class="solution-box"><strong>${label}</strong><br>${s.extra.replace(/\n/g,'<br>')}</div>`;
        }

        container.innerHTML = html;
    }

    function updateFooter() {
        document.getElementById('prevCourse').innerText = document.getElementById('courseCode').value;
        document.getElementById('prevWeek').innerText = document.getElementById('weekNum').value;
    }

    // --- EXPORT LOGIC ---
    function exportPPT(mode) {
        let pres = new PptxGenJS();
        
        const course = document.getElementById('courseCode').value;
        const week = document.getElementById('weekNum').value;

        // Common Settings
        pres.layout = 'LAYOUT_16x9';
        pres.author = 'UniDeck User';
        pres.company = 'University';
        pres.subject = `${course} - ${week}`;

        slides.forEach((s, i) => {
            let slide = pres.addSlide();
            
            // Design Config based on Type
            let bgCol = "FFFFFF";
            let titleCol = "0f172a";
            
            if(s.type === 'tutorial') { bgCol = "f0f9ff"; titleCol = "0369a1"; } // Blue tint for tutorials
            if(s.type === 'discussion') { bgCol = "fff7ed"; titleCol = "c2410c"; } // Orange tint for discussion

            slide.background = { color: bgCol };

            // 1. Title
            slide.addText(s.title, { 
                x: 0.5, y: 0.4, w: "90%", h: 0.8, 
                fontSize: 32, bold: true, color: titleCol, fontFace: "Arial"
            });

            let currentY = 1.3;

            // 2. Image (if exists)
            if(s.imgData) {
                slide.addImage({ data: s.imgData, x: 0.5, y: currentY, w: 4, h: 3, sizing: { type: 'contain', w: 8, h: 3.5 } });
                currentY += 3.6; // Push text down
            }

            // 3. Body Text
            if(s.body) {
                let bullets = s.body.split('\n').map(line => {
                    return { text: line.replace(/^-/, '').trim(), options: { breakLine: true } };
                });
                slide.addText(bullets, {
                    x: 0.5, y: currentY, w: "90%", h: 2.5,
                    fontSize: 18, color: "333333", bullet: true, fontFace: "Arial", lineSpacing: 28
                });
            }

            // 4. HANDLING NOTES vs SOLUTIONS based on MODE
            if (s.extra && s.extra.trim() !== "") {
                if (mode === 'lecturer') {
                    // Lecturer View: Add to Speaker Notes AND visually on slide if it's a solution
                    slide.addNotes(s.extra);
                    
                    if(s.type === 'tutorial') {
                        // Add visible solution box for lecturer
                        slide.addText(`SOLUTION: ${s.extra}`, {
                            x: 0.5, y: 5.5, w: "90%", h: 1.5,
                            fontSize: 14, color: "166534", fill: { color: "dcfce7" },
                            fontFace: "Courier New" 
                        });
                    }
                } else {
                    // Student View:
                    if(s.type === 'tutorial') {
                        // Add a "Workspace" box for them to write in
                        slide.addText("(Write your solution here...)", {
                            x: 0.5, y: 5.5, w: "90%", h: 1.5,
                            fontSize: 14, color: "94a3b8", 
                            shape: pres.ShapeType.rect, 
                            line: { color: "cbd5e1", width: 1, dashType: 'dash' }
                        });
                    }
                    // Speaker notes are NOT added to student PPT
                }
            }

            // Footer
            slide.addText(`${course} | ${week} | Page ${i+1}`, { 
                x: 0.5, y: 6.8, w: "90%", h: 0.3, 
                fontSize: 9, color: "94a3b8" 
            });
        });

        const filename = `${course}_${week}_${mode === 'student' ? 'Student_Copy' : 'Lecturer_Master'}.pptx`;
        pres.writeFile({ fileName: filename });
    }

    // Start
    init();

</script>
</body>
</html>
